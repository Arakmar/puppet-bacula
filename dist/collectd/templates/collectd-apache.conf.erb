# this is totally hardcoded for both the ruby and puppet version
LoadModule passenger_module <%= gem_path %>passenger-<%= passenger_version %>/ext/apache2/mod_passenger.so
PassengerRoot <%= gem_path %>passenger-<%= passenger_version %>
PassengerRuby /usr/bin/ruby

# you probably want to tune these settings
PassengerHighPerformance on
PassengerMaxPoolSize 12
PassengerPoolIdleTime 1500
# PassengerMaxRequests 1000
PassengerStatThrottleRate 120
RackAutoDetect On
RailsAutoDetect Off

<VirtualHost *:<%= port %>>
  ServerName <%= name %>

#  SetEnv CONFIG_PATH /var/lib/visage
#  SetEnv RRDDIR /opt/collectd/var/lib/collectd

  DocumentRoot <%= docroot %>
  RackBaseURI /
  <Directory "<%= docroot %>">
     Options FollowSymLinks Indexes
     AllowOverride None
     Order allow,deny
     Allow from all

     AuthName "Visage Access"
     AuthType Basic
     AuthUserFile /etc/collectd/htpasswd.users
     require valid-user
   </Directory>

  ErrorLog /var/log/apache2/<%= name %>_error.log
  LogLevel warn
  CustomLog /var/log/apache2/<%= name %>_access.log combined
  ServerSignature On

</VirtualHost>

