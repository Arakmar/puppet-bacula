NameVirtualHost <%= ipaddress %>:<%= port %>
<VirtualHost <%= ipaddress %>:<%= port %>>
  ServerName <%=srvname%>
  DocumentRoot <%= docroot %>

  # Support SSL Redirection for authentication
  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/login(.*)$ https://%{SERVER_NAME}/login$1 [R,L]

  RewriteCond %{HTTPS} !=on
  RewriteRule ^/account/register$ https://%{SERVER_NAME}/account/register [R,L]
<% if ssl == true %>
  RequestHeader set X_FORWARDED_PROTO 'https'
  SSLEngine on
  SSLCertificateFile /etc/ssl/certs/pl.cert
  SSLCertificateKeyFile /etc/ssl/private/pl.key
<% end %>
  ProxyRequests Off

  <Proxy *>
     Order deny,allow
     Allow from all
  </Proxy>

  ProxyPass / http://localhost:8080/
  ProxyPassReverse / http://localhost:8080/

  # Redirects for locations that have been moved from the wiki into the docs site:
  Redirect permanent /projects/puppet/wiki/Language_Tutorial http://docs.puppetlabs.com/guides/language_guide.html

  # Custom log file locations
  ErrorLog  /var/log/apache2/<%= name %>_error.log
  CustomLog /var/log/apache2/<%= name %>_access.log combined

</VirtualHost>
