NameVirtualHost <%= ipaddress %>:<%= port %>
<VirtualHost <%= ipaddress %>:<%= port %>>
  ServerName <%=srvname%>
  DocumentRoot <%= docroot %>

  # Support SSL Redirection for authentication
  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/login(.*)$ https://%{SERVER_NAME}/login$1 [R,L]

  RewriteCond %{HTTPS} !=on
  RewriteRule ^/account/register$ https://%{SERVER_NAME}/account/register [R,L]
<% if ssl == true %>
  RequestHeader set X_FORWARDED_PROTO 'https'
  SSLEngine on
  SSLCertificateFile /etc/ssl/certs/pl.cert
  SSLCertificateKeyFile /etc/ssl/private/pl.key
<% end %>
  ProxyRequests Off

  <Proxy *>
     Order deny,allow
     Allow from all
  </Proxy>

  # This is a big ugly hardcoded section. So thus rendering it pointless in many
  # ways to manage so freely with puppet as we are. But what can you do?
  # See http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#proxypass for why.
  ProxyPass /projects/puppet/wiki/External_Nodes !
  Redirect permanent	/projects/puppet/wiki/External_Nodes                    http://docs.puppetlabs.com/guides/external_nodes.html
  ProxyPass /projects/puppet/wiki/Frequently_Asked_Questions !
  Redirect permanent	/projects/puppet/wiki/Frequently_Asked_Questions        http://docs.puppetlabs.com/guides/faq.html
  ProxyPass /projects/puppet/wiki/Plugins_In_Modules !
  Redirect permanent	/projects/puppet/wiki/Plugins_In_Modules                http://docs.puppetlabs.com/guides/plugins_in_modules.html
  ProxyPass /projects/puppet/wiki/Development_Creating_Custom_Types !
  Redirect permanent	/projects/puppet/wiki/Development_Creating_Custom_Types http://docs.puppetlabs.com/guides/custom_types.html
  ProxyPass /projects/puppet/wiki/Puppet_Executables !
  Redirect permanent	/projects/puppet/wiki/Puppet_Executables                http://docs.puppetlabs.com/guides/tools.html
  ProxyPass /projects/puppet/wiki/Module_Organisation !
  Redirect permanent	/projects/puppet/wiki/Module_Organisation               http://docs.puppetlabs.com/guides/modules.html
  ProxyPass /projects/puppet/wiki/Language_Tutorial !
  Redirect permanent	/projects/puppet/wiki/Language_Tutorial                 http://docs.puppetlabs.com/guides/language_guide.html
  ProxyPass /projects/puppet/wiki/Getting_Started !
  Redirect permanent	/projects/puppet/wiki/Getting_Started                   http://docs.puppetlabs.com/#getting_started

  ProxyPass /projects/1/wiki/External_Nodes !
  Redirect permanent	/projects/1/wiki/External_Nodes                    http://docs.puppetlabs.com/guides/external_nodes.html
  ProxyPass /projects/1/wiki/Frequently_Asked_Questions !
  Redirect permanent	/projects/1/wiki/Frequently_Asked_Questions        http://docs.puppetlabs.com/guides/faq.html
  ProxyPass /projects/1/wiki/Plugins_In_Modules !
  Redirect permanent	/projects/1/wiki/Plugins_In_Modules                http://docs.puppetlabs.com/guides/plugins_in_modules.html
  ProxyPass /projects/1/wiki/Development_Creating_Custom_Types !
  Redirect permanent	/projects/1/wiki/Development_Creating_Custom_Types http://docs.puppetlabs.com/guides/custom_types.html
  ProxyPass /projects/1/wiki/Puppet_Executables !
  Redirect permanent	/projects/1/wiki/Puppet_Executables                http://docs.puppetlabs.com/guides/tools.html
  ProxyPass /projects/1/wiki/Module_Organisation !
  Redirect permanent	/projects/1/wiki/Module_Organisation               http://docs.puppetlabs.com/guides/modules.html
  ProxyPass /projects/1/wiki/Language_Tutorial !
  Redirect permanent	/projects/1/wiki/Language_Tutorial                 http://docs.puppetlabs.com/guides/language_guide.html
  ProxyPass /projects/1/wiki/Getting_Started !
  Redirect permanent	/projects/1/wiki/Getting_Started                   http://docs.puppetlabs.com/#getting_started


  # Now anything that is left, lets proxy this to localhost.
  ProxyPass / http://localhost:8080/
  ProxyPassReverse / http://localhost:8080/

  # Custom log file locations
  ErrorLog  /var/log/apache2/<%= name %>_error.log
  CustomLog /var/log/apache2/<%= name %>_access.log combined

</VirtualHost>
