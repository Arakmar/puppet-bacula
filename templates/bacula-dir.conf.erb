#
# Default Bacula Director Configuration file
#
#  The only thing that MUST be changed is to add one or more
#   file or directory names in the Include directive of the
#   FileSet resource.
#
#  For Bacula release 3.0.2 (18 July 2009) -- ubuntu 10.04
#
#  You might also want to change the default email address
#   from root to your address.  See the "mail" and "operator"
#   directives in the Messages resource.
#

Director {                            # define myself
  Name = baal.puppetlabs.com-dir
  DIRport = 9101                # where we listen for UA connections
  QueryFile = "/etc/bacula/scripts/query.sql"
  WorkingDirectory = "/var/lib/bacula"
  PidDirectory = "/var/run/bacula"
  Maximum Concurrent Jobs = 1
  Password = "sOjW+LLjaJYm/a6e7F2v0OTVpXGCsQOHPj5bY68D/v8l"         # Console password
  Messages = Daemon
  DirAddress = 127.0.0.1
}

Client {
  Name = baal.puppetlabs.com-fd
  Address = baal.puppetlabs.com
  FDPort = 9102
  Catalog = MyCatalog
  Password = "pc08mK4Gi4ZqqE9JGa5eiOzFTDPsYseUG"
  File Retention = 60 days
  Job Retention = 6 months
  AutoPrune = yes
}

Client {
  Name = dxul.puppetlabs.com-fd
  Address = dxul.puppetlabs.com
  FDPort = 9102
  Catalog = MyCatalog
  Password = "9haB2+SxaNXF2C1LFdptETvihkk/zKro2Hxf+cQFEbIQ"
  File Retention = 60 days
  Job Retention = 6 months
  AutoPrune = yes
}

Client {
  Name = apu.puppetlabs.com-fd
  Address = apu.puppetlabs.com
  FDPort = 9102
  Catalog = MyCatalog
  Password = "MQI/vywQq5pSlAYaEUJKrmt24Wu8FOIPfT7tFoaOc5X6"
  File Retention = 60 days
  Job Retention = 6 months
  AutoPrune = yes
}

Client {
  Name = enkal.puppetlabs.com-fd
  Address = enkal.puppetlabs.com
  FDPort = 9102
  Catalog = MyCatalog
  Password = "pc08mK4Gi4ZqqE9JGa5eiOzFTDPsYseUG"
  File Retention = 60 days
  Job Retention = 6 months
  AutoPrune = yes
}

Client {
  Name = chuku.puppetlabs.com-fd
  Address = chuku.puppetlabs.com
  FDPort = 9102
  Catalog = MyCatalog
  Password = "MQI/vywQq5pSlAYaEUJKrmt24Wu8FOIPfT7tFoaOc5X6"
  File Retention = 60 days
  Job Retention = 6 months
  AutoPrune = yes
}

Job {
  Name = "baal"
  Type = Backup
  Client = baal.puppetlabs.com-fd
  FileSet = "PuppetLabsOps"
  Storage = File
  Pool = Default
  Full Backup Pool = PuppetLabsPool-Full
  Incremental Backup Pool = PuppetLabsPool-Inc
  Messages = Standard
  Where = /tmp/bacula-restores
  JobDefs = "PuppetLabsOps"
}

Job {
  Name = "dxul"
  Type = Backup
  Client = dxul.puppetlabs.com-fd
  FileSet = "PuppetLabsOps"
  Storage = File
  Pool = Default
  Full Backup Pool = PuppetLabsPool-Full
  Incremental Backup Pool = PuppetLabsPool-Inc
  Messages = Standard
  Where = /tmp/bacula-restores
  JobDefs = "PuppetLabsOps"
}

Job {
  Name = "apu"
  Type = Backup
  Client = apu.puppetlabs.com-fd
  FileSet = "PuppetLabsOps"
  Storage = File
  Pool = Default
  Full Backup Pool = PuppetLabsPool-Full
  Incremental Backup Pool = PuppetLabsPool-Inc
  Messages = Standard
  Where = /tmp/bacula-restores
  JobDefs = "PuppetLabsOps"
}

Job {
  Name = "enkal"
  Type = Backup
  Client = enkal.puppetlabs.com-fd
  FileSet = "PuppetLabsOps"
  Storage = File
  Pool = Default
  Full Backup Pool = PuppetLabsPool-Full
  Incremental Backup Pool = PuppetLabsPool-Inc
  Messages = Standard
  Where = /tmp/bacula-restores
  JobDefs = "PuppetLabsOps"
}

Job {
  Name = "chuku"
  Type = Backup
  Client = chuku.puppetlabs.com-fd
  FileSet = "PuppetLabsOps"
  Storage = File
  Pool = Default
  Full Backup Pool = PuppetLabsPool-Full
  Incremental Backup Pool = PuppetLabsPool-Inc
  Messages = Standard
  Where = /tmp/bacula-restores
  JobDefs = "PuppetLabsOps"
}

Job {
  Name = "RestoreFiles"
  Type = Restore
  Client = baal.puppetlabs.com-fd
  FileSet = "PuppetLabsOps"
  Storage = File
  Where = /tmp/bacula-restores
  Messages = Standard
  Pool = Default
}

JobDefs {
  Name = "PuppetLabsOps"
  Type = Backup
  Schedule = "WeeklyCycle"
  Messages = Standard
  Priority = 10
}

FileSet {
  Name = PuppetLabsOps
  Include {
    Options {
      signature = MD5
      compression=gzip  
  }
    File = /etc
    File = /opt
    File = /var/www
    File = /var/lib/bacula/mysql
  }
  Exclude {
    File = /var/www/puppetlabs.com/downloads
  }
}

Schedule {
  Name = "WeeklyCycle"
  Run = Level=Full sun at 2:05
  Run = Level=Incremental mon-sat at 2:05
}

Pool {
  Name = Default
  Pool Type = Backup
}

Pool {
  Name = PuppetLabsPool-Full
  Pool Type = Backup
  Recycle = Yes
  AutoPrune = Yes
  Volume Retention = 6 months
  Maximum Volume Jobs = 24
  Label Format = Full-
  Maximum Volumes = 18
}

Pool {
  Name = PuppetLabsPool-Inc
  Pool Type = Backup
  Recycle = yes           # automatically recycle Volumes
  AutoPrune = yes         # Prune expired volumes
  Volume Retention = 24 days
  Maximum Volume Jobs = 60
  Label Format = Inc-
  Maximum Volumes = 7
}
# Definition of file storage device
Storage {
  Name = File
  Address = baal.puppetlabs.com                # N.B. Use a fully qualified name here
  SDPort = 9103
  Password = "kIw4ISyjT8PlbMrPgZB_WBsBb5ckS5hND"
  Device = PuppetLabsFileStorage
  Media Type = File
}

# Generic catalog service
Catalog {
  Name = MyCatalog
  dbname = "bacula"; dbuser = "bacula"; dbpassword = ""
}

# Reasonable message delivery -- send most everything to email address
#  and to the console
Messages {
  Name = Standard
  mailcommand = "/usr/lib/bacula/bsmtp -h localhost -f \"\(Bacula\) \<%r\>\" -s \"Bacula: %t %e of %c %l\" %r"
  operatorcommand = "/usr/lib/bacula/bsmtp -h localhost -f \"\(Bacula\) \<%r\>\" -s \"Bacula: Intervention needed for %j\" %r"
  mail = root@localhost = all, !skipped            
  operator = root@localhost = mount
  console = all, !skipped, !saved
  append = "/var/lib/bacula/log" = all, !skipped
  catalog = all
}

Messages {
  Name = Daemon
  mailcommand = "/usr/lib/bacula/bsmtp -h localhost -f \"\(Bacula\) \<%r\>\" -s \"Bacula daemon message\" %r"
  mail = root@localhost = all, !skipped            
  console = all, !skipped, !saved
  append = "/var/lib/bacula/log" = all, !skipped
}

#
# Restricted console used by tray-monitor to get the status of the director
#
Console {
  Name = baal.puppetlabs.com-mon
  Password = "EWDjRkucylqjSjwtX_y2UKlS-Ihr4E01V"
  CommandACL = status, .status
}
