#!/bin/sh

# Disable lb_healthcheck
/root/bin/lb_healthcheck stop

# Sleep while current connections die out
sleep 10

# Shut down IC
service interchange stop

if [ -f /var/log/interchange/debug.log.1 ]; then
    echo "moving debug.log.1 to debug.log.2"
    mv /var/log/interchange/debug.log.1 /var/log/interchange/debug.log.2

    echo "gzipping debug.log.2"
    gzip /var/log/interchange/debug.log.2
    chown interch: /var/log/interchange/debug.log*
fi


echo "moving debug.log to debug.log.1"
mv /var/log/interchange/debug.log /var/log/interchange/debug.log.1

echo "gzipping debug.log.1"
gzip /var/log/interchange/debug.log.1

touch /var/log/interchange/debug.log
chown interch: /var/log/interchange/debug.log

# Start IC back up
su - interch -c 'restart-ic'

# Re-enable lb_healthcheck
/root/bin/lb_healthcheck start
