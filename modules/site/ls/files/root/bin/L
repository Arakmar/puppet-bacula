#!/bin/sh

trap "exit 1" INT

. ~interch/etc/server-list.sh

for i in $servers
#for i in $all_servers
#for i in $backup_servers
#for i in $rodb_servers belay
#for i in $rodb_servers
#for i in $other_servers
#for i in $new_syslog_servers
do
    echo $i

    #ssh $i 'psql -U bcs bcs -c "GRANT SELECT on subcat_alias TO bcs_readonly; GRANT SELECT on subcat_alias TO outlet_readonly; GRANT SELECT on subcat_alias TO dogfunk_readonly; GRANT SELECT on subcat_alias TO tramdock_readonly; GRANT SELECT on subcat_alias TO explore64_readonly; GRANT SELECT on subcat_alias TO steepcheap_readonly; GRANT SELECT on subcat_alias TO wm_readonly;"'
    #ssh $i 'grep purge /var/spool/cron/interch'
    #cat 20071107-add-channel-column-to-referrers.sql | ssh $i 'psql -U bcs bcs'
	#ssh $i 'mkdir /var/www/html/page_cache; chown interch:interch /var/www/html/page_cache'
	#ssh $i 'mount -t nfs cacheroot.vw.bcinfra.net:/var/gfsroot/cacheroot /var/www/html/page_cache'

    #ssh $i " echo 'cacheroot.vw.bcinfra.net:/var/gfsroot/cacheroot /var/www/html/page_cache nfs defaults 0 2' >> /etc/fstab"

    #ssh $i 'grep DOWN /etc/httpd/conf/steepcheap.conf'
	GET -H 'Host: www.steepandcheap.com' http://$i:88/ | grep -i down
	#ssh $i 'uptime; free'
	#ssh $i 'ps auxww | grep minilogd | grep -v grep'
	#ssh $i 'ps auxww | grep log | grep -v grep'
	#ssh $i 'chkconfig syslog-ng on; chkconfig syslog off'
	#ssh $i 'chkconfig --list | sort | grep syslog'
	#ssh $i 'service syslog stop; killall minilogd; service syslog-ng start'
	#ssh $i 'tail -10000 /var/log/interchange/error.log | grep -i catalog | grep steepcheap'
	#ssh $i 'tail -10000 /var/log/httpd/access_log /var/log/interchange/{error,debug}.log /var/log/interchange/steepcheap/error.log | grep "71\\.37\\.71\\.90"'
	#ssh $i 'tail -10000 /var/log/httpd/access_log | grep buzzard'
    #ssh $i 'GET -H "Host: www.steepandcheap.com" http://localhost:88 | grep "mv_order_item" | wc -l'
    #echo "25 */3 * * * nice bin/purge-ic-work-files 2>/dev/null" | ssh $i 'cat > /var/spool/cron/interch'
    #ssh $i 'rm -vf /var/spool/cron/postgres'
	#ssh $i "psql -U bcs bcs -c \"select * from woot_items where start_date::date = current_date and catalog_id = 'steepcheap' and available_to_sell order by sort_order limit 1\""
	#ssh $i "psql -U bcs bcs -c \"select * from steepcheap.sprice_range where sku_class = 'BLD0724'\""
    #ssh $i 'ps auwwwx | grep interchange | wc -l'
	#ssh $i 'crontab -l'
    #ssh root@$i 'shutdown -r now'
    # ssh root@$i 'GET -H 'Host: www.backcountry.com' http://localhost'
    #ssh root@$i 'host livedb; host rootdb'
    # scp -p /etc/hosts $i:/etc/hosts 
    #scp -r -p /root/.ssh/ $i:/root/.ssh/
	#ssh root@$i 'psql -U bcs bcs -c "\d merch_groups"'
	#ssh $i 'grep SQLDSN_RW /var/lib/interchange/etc/server.cfg'
	#/root/bin/put_ssh_key root@$i bgibson 
	#cat hack-fix-chown.txt | ssh root@$i 'cat >> /var/spool/cron/root'
	#psql -U bcs bcs -c "select count(*) from sprice where sku_class = 'COL0249'"
#	cat <<END | ssh $i
#psql -U bcs bcs -c "select qty from inventory where sku = 'COL0249-ODNS-L' and status = 'on_hand'"
#END
	#ssh $i 'rm -rf ~interch/image_repair'
    #scp -p -i .ssh/id_dsa.bcs-push-robot-root /etc/httpd/conf/httpd.conf $i:/etc/httpd/conf/
    #scp -p -i .ssh/id_dsa.bcs-push-robot-root /etc/httpd/conf/wm.conf $i:/etc/httpd/conf/
    #ssh -i .ssh/id_dsa.bcs-push-robot-root root@$i 'service httpd restart'
    #scp -p -i .ssh/id_dsa.bcs-push-robot-root -p /etc/hosts $i:/etc/
    #scp -p -i .ssh/id_dsa.bcs-push-robot-root -p /root/.ssh/known_hosts $i:/root/.ssh/
    #scp -p -i .ssh/id_dsa.bcs-push-robot-root -p /etc/resolv.conf $i:/etc/
	#if [ -n "`echo $rodb_servers | grep $i`" ]; then
	#	scp -p -i .ssh/id_dsa.bcs-push-robot-root /var/lib/pgsql/data/pg_hba.conf root@$i:/var/lib/pgsql/data/
	#	ssh -i .ssh/id_dsa.bcs-push-robot-root root@$i 'service postgresql reload'
	#fi

    ## webapps
	#if [ -n "`echo $servers | grep $i`" ]; then
	#	scp -p /var/lib/interchange/etc/server.cfg $i:/var/lib/interchange/etc/
	#	ssh -i .ssh/id_dsa.bcs-push-robot-root $i "perl -pi -e 's/alta/$i/' /var/lib/interchange/etc/server.cfg"
	#	ssh -i .ssh/id_dsa.bcs-push-robot-root $i 'su -c "bin/restart-ic" - interch'
	#fi

	#scp -p /tmp/tb_cache_counts.pl $i:/usr/local/libexec/
    #/root/bin/put_ssh_key root@$i srussell
    #ssh $i 'ps auwwwwx | grep interchange | wc -l'
#	cat <<END | ssh $i
#psql -U bcs bcs -c "select * from settings where name='gateway'"
#END
    #ssh $i "perl -MCPAN -e'install JSON'"
	#scp -p ~interch/bin/restart-ic interch@$i:bin/
    #ssh root@$i "psql -U bcs bcs -c 'select version()'"
    #ssh $i "psql -U bcs bcs -c 'select count(*) from email_news_subscribers'"
    #scp -p /tmp/logrotate-syslog $i:/tmp/logrotate-syslog
    #scp -p /etc/logrotate.d/syslog $i:/tmp/logrotate-syslog
    #ssh $i 'diff -u /etc/logrotate.d/syslog /tmp/logrotate-syslog; rm -f /tmp/logrotate-syslog'
	#ssh $i 'perl -pi -e "s/^(.*?pull.*)/# \$1/m" /var/spool/cron/interch' | grep pull
	#ssh $i 'grep pull /var/spool/cron/interch'
	#ssh $i 'service bc_server_agent stop; chkconfig bc_server_agent off'
	#scp -p postgresql.conf $i:/var/lib/pgsql/data/
	#ssh $i 'service postgresql restart'
	#scp -p ~interch/bcs/stores.cfg interch@$i:bcs/
	#psql -h $i -U bcs bcs -c 'SELECT CURRENT_TIMESTAMP, sku FROM products LIMIT 1'
	#psql -h $i -U bcs bcs -c 'SHOW max_connections'
	#ssh $i 'grep SQLDSN ~interch/etc/server.cfg'
	#ssh $i 'cat /etc/bc-role'
	#ssh interch@$i 'cat bcs/stores.cfg'
	#ssh interch@$i 'cat steepcheap/stores.cfg'
	#ssh interch@$i 'find bcs/session/ -type f  -mtime -1 | wc -l'
	#ssh interch@$i 'ls -lFa */ | grep session'
	#ssh interch@$i 'rm -rf bcs/session/*'
	#ssh interch@$i 'rm -f ~interch/steepcheap/stores.cfg'
	#scp -p ~interch/steepcheap/stores.cfg interch@$i:steepcheap/
	#scp -p /usr/lib/interchange/interchange_local.cfg interch@$i:/usr/lib/interchange/
	#scp -p /usr/lib/interchange/lib/Vend/Table/Common.pm interch@$i:/usr/lib/interchange/lib/Vend/Table/
	#ssh interch@$i 'bin/restart-ic'
	#scp -p interch@$i:/usr/lib/interchange/interchange_local.cfg IL.$i
	#scp -p ~interch/wm/local.cfg interch@$i:wm/
	#ssh $i 'service httpd start'
	#ssh $i 'ps auxww | grep -c ^postgres'
	#ssh $i "perl -MStorable -e 'print \$Storable::VERSION, \$/'"
    #ssh $i 'ls -l /tmp/error500.log'
	#[ "$i" = lowe ] && echo "skipping" && continue
	#echo starting `date`
	#ssh $i 'psfile=/tmp/ps.$$; ps auxww > $psfile; grep -c interchange $psfile; grep -c /var/www/cgi-bin/ $psfile; rm -f $psfile'
	#ssh $i 'df -hT'
	#ssh $i 'grep "timed out waiting 3 seconds" /var/log/interchange/*/error.log'
	#ssh $i '~/bin/pg_du -h -s -U bcs bcs'
    #ssh $i 'perl -MCPAN -e "install XML::Writer"'
	#ssh $i 'rm -fv ~interch/bcs/timed_build/index_*'
	#ssh $i bin/disk-space-watch
	#ssh $i w
	#cat <<END | ssh $i '/usr/local/bin/perl -MCPAN -eshell'
#install Scalar::Util
#install Moose
#END
	#ssh $i date
	#scp -p /etc/httpd/conf/httpd.conf $i:/etc/httpd/conf/
	#ssh $i 'service httpd graceful'
	#ssh $i 'grep KeepAlive /etc/httpd/conf/httpd.conf | grep -v "^ *#"'
	#ssh $i uptime
	#tar cp wm-rollout | ssh $i 'tar xvp && cd wm-rollout && ./catalog-shadow-tables-create.pl && psql -U bcs bcs -f grant-readonly.sql'
	#tar cp /etc/httpd/conf/*.conf /var/www/cgi-bin/wm | ssh $i 'cd / && tar xvp && service httpd graceful'
	#psql -h $i -U postgres bcs -c "SELECT max(last_modified) FROM inventory"
	#psql -h $i -U postgres bcs -c '\d inventory'
	#ssh $i 'grep ^SELINUX= /etc/sysconfig/selinux'
	#ssh $i 'ps auxww | grep cgi-bin | grep -v grep | wc -l'
	#tar cp /var/lib/interchange/{corporate,explore64,steepcheap,tramdock}/local.cfg /etc/hosts | ssh $i 'cd / && tar xvp'
	#ssh $i 'rm -rf bc-cluster-server-setup/postgresql' && scp -pr bc-cluster-server-setup/postgresql $i:bc-cluster-server-setup/ && ssh $i 'service bc_server_agent stop && service postgresql stop && rpm -Fvh bc-cluster-server-setup/postgresql/*.rpm && chmod -x /var/log/pgsql && service postgresql start && service bc_server_agent start'
	#ssh $i 'rm -rf bc-cluster-server-setup/postgresql' && scp -pr bc-cluster-server-setup/postgresql $i:bc-cluster-server-setup/ && ssh $i 'service httpd stop; service interchange stop; killall -9 interchange; rpm -Fvh bc-cluster-server-setup/postgresql/*.rpm && chmod -x /var/log/pgsql && service interchange start && service httpd start'
	#scp -p ~interch/bcs/catalog.cfg $i:~interch/bcs/
	#ssh $i bin/restart-apache-ic
	#ssh $i 'grep "too many clients" /var/log/interchange/error.log'
	#ssh $i 'chown postgres:postgres  ~postgres/bin/*'
	#version=`ssh $i "/usr/local/bin/perl -MStorable -e'print \\$Storable::VERSION'"`
	#echo "Found version $version"
	#[ "$version" = "2.15" ] && continue
	#ssh $i 'echo "force install Storable" | /usr/local/bin/perl -MCPAN -eshell'
	#scp -p /var/lib/interchange/bcs/etc/profile_include/{bill_me_later,checkout_onestep,credit_card} $i:/var/lib/interchange/bcs/etc/profile_include/
	#ssh $i 'chown interch:interch /var/www/html'
	#ssh $i 'bin/disk-space-watch; service httpd stop; su - -c "vacuumdb -a -z -f" postgres; bin/disk-space-watch; service httpd start; echo'
	#ssh $i 'cat /etc/redhat-release; uname -a; rpm -q kernel'
    #ssh $i 'du -hs /var/lib/pgsql/data/*; service httpd stop; psql -U bcs bcs -c "VACUUM FULL;"; service httpd start; du -hs /var/lib/pgsql/data/*;'
    #ssh $i 'tail /var/log/interchange/error.log /var/log/interchange/*/error.log /var/log/httpd/error_log'
	#psql -h $i -U postgres bcs -f bucardo.satellite
	#ssh $i 'grep -i "attribute 15" /var/log/pgsql'
	#ssh $i 'du -hsc /var/lib/pgsql/data'
	#ssh $i 'ps auxww|grep ^postgres'
	#ssh $i 'ls -lFa /var/log/interchange'
	#ssh $i 'shopt -s huponexit; cd /var/log/interchange && mv debug.log debug.log.1 && nice gzip debug.log.1 >/dev/null 2>&1 &' </dev/null >/dev/null 2>&1 &
	#ssh $i 'cd /var/log/interchange && mv debug.log debug.log.1'
	#ssh $i 'ls -lFA /var/log/interchange'
	#ssh $i 'ls -lFA /var/log/interchange/debug.log'
	#ssh $i 'tail -50 /var/log/interchange/error.log'
	#ssh interch@$i 'cd /var/lib/interchange && rm -rfv bcs/timed_build/promo_image_rotation/*'
    #cd ~interch && tar cp discontinued_field_files | ssh interch@$i 'cd ~ && tar xvp'
    #tar cp /etc/httpd/conf/{bcs.conf,outlet.conf,dogfunk.conf,tramdock.conf,steepcheap.conf,explore64.conf,corporate.conf} | ssh $i 'cd / && tar xvp && service httpd graceful'
	#ssh interch@$i 'nice rm -rf bcs/{session,tmp}/*'
	#scp -p /var/www/cgi-bin/error500 $i:/var/www/cgi-bin/
    #ssh $i 'chown interch:interch /var/www/cgi-bin/error500'
    #scp -p ~interch/steepcheap/templates/steepcheap/components/shipping_information interch@$i:/var/lib/interchange/steepcheap/templates/steepcheap/components
	#scp -p ~interch/bin/service-httpd $i:/var/lib/interchange/bin/
	#scp -p ~interch/bin/purge-timed-local interch@$i:bin/
	#ssh $i 'chown interch:interch /var/www/html'
	#ssh $i 'cd /var/www/html; find . -type f \! -user interch -a \! -group interch'
	#scp -p /etc/rsyncd.conf /etc/rsyncd.secrets $i:/etc/
	#scp -p ~interch/bcs/pages/bc_server_agent.html interch@$i:bcs/pages
	#scp -p /var/www/html/docs/bc_server_agent.txt $i:/var/www/html/docs/
	#scp -p /etc/init.d/bc_server_agent $i:/etc/init.d/
	#scp -p /usr/sbin/bc_server_agent $i:/usr/sbin/
	#ssh $i 'service bc_server_agent stop ; sleep 1; killall bc_server_agent; sleep 1; service bc_server_agent start'
	#ssh $i 'bin/restart-apache-ic; service bc_server_agent stop ; sleep 1; killall bc_server_agent; sleep 1; service bc_server_agent start'
	#tar cp /usr/lib/interchange/bin/interchange* /usr/lib/interchange/lib/Vend/Util.pm | ssh interch@$i 'cd / && tar xvp'
	#ssh $i '/usr/local/bin/perl -MCPAN -einstall\ MIME::Lite && bin/restart-apache-ic'
	#scp -p /etc/httpd/conf/steepcheap.conf $i:/etc/httpd/conf/
	#scp -p /var/www/cgi-bin/polite_redirect $i:/var/www/cgi-bin/
	#ssh $i 'service httpd graceful'
	#ssh $i 'grep "^Variable *TRAFFIC" /usr/lib/interchange/interchange.cfg'
	#scp /var/lib/interchange/steepcheap/site.cfg interch@$i:~/steepcheap/
	#scp -p /var/lib/interchange/bin/push-files interch@$i:~/bin/
	#ssh root@$i 'tail -n 15 /var/log/messages'
	#scp /etc/syslog-ng.conf root@$i:/etc/syslog-ng.conf
	#ssh root@$i '/etc/init.d/syslog-ng status' 
	#ssh root@$i 'chkconfig --level 2345 syslog-ng on'
	#ssh root@$i 'service xinetd reload'
	#scp /root/event*.rpm root@$i:/root
	#scp /root/syslog*el4*.rpm root@$i:/root
	#ssh root@$i 'rpm -i /root/eventlog-0.2.5-1.el4.i386.rpm'	
	#ssh root@$i 'rpm -i /root/syslog-ng-2.0.4-1.el4.i386.rpm'
	#scp /etc/sysconfig/rhn/sources root@$i:/etc/sysconfig/rhn/sources
	#ssh root@$i 'up2date -u'
	#ssh root@$i 'df -h' 

done
