NameVirtualHost <%=ipaddress%>:<%= port %>
<VirtualHost <%=ipaddress%>:<%= port %>>
  <% if ssl == true %>
  SSLEngine on
  SSLCertificateFile <%=ssl_path%>/certs/pl.cert
  SSLCertificateKeyFile <%=ssl_path%>/private/pl.key
  <% end %>
  ServerName <%= name %>
  ServerAlias <%= serveraliases %>
  DocumentRoot <%= docroot %>
  ServerSignature Off
  <Directory <%= docroot %>>
    Options Indexes FollowSymLinks
    AllowOverride FileInfo
    Order allow,deny
    Allow from all
  <% if ssl == true %>
    <% if auth == true %> # Only enable authentication of ssl is enabled
    # Enable Authentication
    AuthType basic
    AuthName "private area"
    AuthBasicProvider file
    AuthUserFile <%=docroot%>/.htpasswd
    Require valid-user
    <% end %>
  <% end %>
  <% if redirect_ssl == true %>
    # Redirect to ssl
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
  <% end %>
  </Directory>
</VirtualHost>

